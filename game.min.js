(function(){"use strict";function a(a){let b=a.length%20;return html`
        <div class="line">
            <div class="glitch">
                <div class="glitch1 noise${b}">${a}</div>
                <div class="glitch2 noise${b}">${a}</div>
                <div class="glitch3 noise${b}">${a}</div>
            </div>
        </div>
    `}function b(b,c,{align:d="stretch",justify:e="stretch",cls:f=""}={}){return html`
        <div class="block ${b} ${f}"
            style="grid-area: ${b}; align-self: ${d}; justify-self: ${e};">
            ${c.map(a)}
        </div>
    `}function c(a){return"#"===a.charAt(0)&&(a=a.substr(1)),3===a.length&&(a=a.split("").map((a)=>a+a).join("")),a.match(/.{1,2}/g).map((a)=>parseFloat((parseInt(a,16)/255).toFixed(2)))}function d(a){let{position:b,scale:c}=a,d=new Cervus.core.Entity({components:[new Cervus.components.Transform({position:b})]}),e=new Cervus.shapes.Box;e.get_component(Cervus.components.Render).set({material:r,color:l}),e.get_component(Cervus.components.Transform).set({scale:c}),d.add(e);let{neon_position:f,neon_scale:g,neon_color:h}=a,i=new Cervus.shapes.Box;i.get_component(Cervus.components.Render).set({material:q,color:h}),i.get_component(Cervus.components.Transform).set({position:f,scale:g});let j=new Cervus.core.Entity({components:[new Cervus.components.Transform({position:[0,0,-2]}),new Cervus.components.Light({color:h,intensity:0.6})]});i.add(j),d.add(i),n.add(d)}const e={lastActive:"Power Fallback",systems:{"Power Fallback":"Online","Grid Movement":"Online",Perspective:"Offline","Enhanced DoF":"Offline","Chromatic Vision":"Offline"}};var f=createStore(function(a=e,b,c){switch(b){case"ACTIVATE":{let[b]=c;return Object.assign({},a,{lastActive:b,systems:Object.assign({},a.systems,{[b]:"Online"})})}default:return a;}}),g=function*(){for(let a=Cervus.shaders.fragment.toString().split("\n").slice(7,-2).map((a)=>a.trim()).filter(Boolean),b=0;;)yield a[b++%a.length]}();let h=document.styleSheets[0],j=20,i=new Intl.NumberFormat("en",{style:"percent"});for(let a=0;20>a;a++)h.insertRule(`
        @keyframes noise${a} {
            ${Array(j).fill(1).map((a,b)=>`
                ${i.format(b/j)} {
                    clip-path: inset(
                        ${i.format(Math.random())} 0
                        ${i.format(Math.random())}
                    );
                }
            `).join("")}
        }
    `),h.insertRule(`
        .glitch2.noise${a} {
            animation: noise${a} ${5*Math.random()}s linear infinite alternate;
        }
    `),h.insertRule(`
        .glitch3.noise${a} {
            animation: noise${a} ${5*Math.random()}s linear infinite alternate;
        }
    `);const k="333",l="000",m=["28D7FE","A9FFDC","FED128"],n=new Cervus.core.Game({width:window.innerWidth,height:window.innerHeight,far:1e3,clear_color:k});n.canvas.addEventListener("click",()=>n.canvas.requestPointerLock()),n.camera.get_component(Cervus.components.Transform).position=[0,20,0],n.camera.get_component(Cervus.components.Move).keyboard_controlled=!0,n.camera.get_component(Cervus.components.Move).move_speed=35,n.remove(n.light);const o=new Cervus.shapes.Box,p=o.get_component(Cervus.components.Render);let q=new Cervus.materials.BasicMaterial({requires:[Cervus.components.Render,Cervus.components.Transform]});q.add_fog({color:c(k),distance:new Float32Array([100,500])});let r=new Cervus.materials.PhongMaterial({requires:[Cervus.components.Render,Cervus.components.Transform]});r.add_fog({color:c(k),distance:new Float32Array([5,300])});const s=new Cervus.materials.WireframeMaterial({requires:[Cervus.components.Render,Cervus.components.Transform]}),t=new Cervus.shapes.Box;t.get_component(Cervus.components.Render).material=r,t.get_component(Cervus.components.Render).color=l,t.get_component(Cervus.components.Transform).scale=[1000,1,1000],n.add(t),d({position:[20,0,100],scale:[50,500,40],neon_position:[0,240,-22],neon_scale:[25,10,1],neon_color:m[0]}),d({position:[-30,0,50],scale:[45,40,15],neon_position:[15,15,-10],neon_scale:[10,5,1],neon_color:m[1]}),d({position:[-30,0,120],scale:[35,300,40],neon_position:[0,140,-22],neon_scale:[20,10,1],neon_color:m[2]});var u=f.connect(function({lastActive:a,systems:c}){let d=[];for(let[b,e]of Object.entries(c))d.push(`${b} = ${e}`);return html`
        <div class="screen layout">
            ${b("tl",["System status",...d])}
            ${b("tm",["N ----- NE ----- E"],{justify:"center"})}
            ${b("tr",[new Date().toString()],{justify:"end"})}
            ${b("ml",["Active objectives","> 01. Enhance capabilities","> 02. Locate exit","> 03. Init logout sequence"])}
            ${b("mm",[a,"<div class='box big'>Activated</div>"],{align:"center",justify:"center",cls:"flicker"})}
            ${b("mr",["Running analysis","Assessment complete","<div class=box>No threats found</div>"])}
            ${b("bl",["Avatar entity matrix",""," ","  ","   "],{align:"end"})}
            ${b("br",Array(10).fill(""),{align:"end"})}
        </div>
    `});let v,w=document.querySelector("#root");w.addEventListener("beforerender",function(){clearInterval(v)}),w.addEventListener("afterrender",function(){v=setInterval(()=>{let b=document.createElement("div"),c=w.querySelector(".br");c.removeChild(c.firstElementChild),b.innerHTML=a(g.next().value),c.appendChild(b.firstElementChild);let d=w.querySelector(".tr .glitch");for(let a of d.children)a.textContent=new Date().toString()},1e3)});let x=new Intl.NumberFormat("en",{minimumFractionDigits:3,maximumFractionDigits:3});n.on("afterrender",function(){let a=w.querySelector(".bl"),b=n.camera.get_component(Cervus.components.Transform).matrix,c=[[b[0],b[4],b[8],b[12]],[b[1],b[5],b[9],b[13]],[b[2],b[6],b[10],b[14]],[b[3],b[7],b[11],b[15]]],d=[];for(let[a,b]of d.entries()){for(let d of b.querySelector(".glitch").children)d.textContent=c[a].map((a)=>x.format(a)).join(" ");a++}}),f.attach(u,document.querySelector("#root")),window.dispatch=f.dispatch})();
